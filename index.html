<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>AAP.Electroconversor</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{
  margin:0;
  font-family: Arial, sans-serif;
}

.fundo{
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:url("fundo.jpeg") no-repeat center center;
  background-size:cover;
  opacity:0.25;
  z-index:-1;
}

/* Layout mais compacto */
.container{
  padding-top: 4rem;
  padding-bottom: 4rem;
}

/* Card flutuante */
.app-card{
  border-radius: 24px;
  border: none;
  box-shadow: 0 30px 70px rgba(0,0,0,.10);
  padding: 30px;
  background: rgba(255,255,255,0.97);
  backdrop-filter: blur(6px);
}

.logo{
  height: 75px;
  border-radius: 10px;
  box-shadow: 0 6px 15px rgba(10,1,59,.12);
}

.app-title{
  font-size: 1.6rem;
  font-weight: 700;
  color:#2b8fd3;
}

.title-lines{
  margin:8px auto 0;
  max-width:200px;
}

.title-lines div{
  height:3px;
  background:#7ec3f1;
  border-radius:10px;
  margin-top:8px;
}

.title-lines .l1{ width:180px; }
.title-lines .l2{ width:130px; opacity:.7; }

.form-label{
  font-weight:600;
  color:#4b5563;
}

.form-control, .form-select{
  border:1.5px solid #6fb36a;
  border-radius:10px;
  padding:8px;
}

.form-control:focus, .form-select:focus{
  box-shadow:0 0 0 .15rem rgba(111,179,106,.2);
  border-color:#5aa955;
}

.resultado{
  font-size:1rem;
  font-weight:600;
  color:#374151;
}

/* Botão Novo suave e elegante */
.btn-novo{
  background-color:#636e68d3;   /* verde acinzentado suave */
  border:none;
  color:white;
  font-weight:600;
  transition:.2s ease;
}

.btn-novo:hover{
  background-color:#4e7a60;
  transform:translateY(-1px);
  box-shadow:0 6px 14px rgba(0,0,0,.12);
}

.btn{
  border-radius:12px;
}

.linha-preco{
  display:flex;
  align-items:center;
  gap:10px;
}

.linha-preco .rotulo-euro{
  margin-left:auto;
  font-weight:600;
  color:#6b7280;
}

/* Modal/tabela */
.table thead th{
  color:#4b5563;
  white-space: nowrap;
}
.table td{
  vertical-align: middle;
}
</style>
</head>

<body>
<div class="fundo"></div>

<div class="container">
  <div class="row justify-content-center">
    <div class="col-lg-5 col-md-7 col-sm-9">

      <div class="app-card">

        <!-- Cabeçalho -->
        <div class="d-flex align-items-center justify-content-center position-relative mb-3">
          <img src="LOGO.png" class="logo position-absolute start-0 top-50 translate-middle-y">
          <div class="text-center">
            <div class="app-title">AAP.Conversor.Digital</div>
            <div class="title-lines">
              <div class="l1"></div>
              <div class="l2"></div>
            </div>
          </div>
        </div>

        <!-- Tipo -->
        <div class="mb-3">
          <label class="form-label">Tipo de cabo</label>
          <div class="row g-2">
            <div class="col-6">
              <select class="form-select" id="bitola">
                <option value="">Bitola</option>
                <option value="1.5">1.5 mm²</option>
                <option value="2.5">2.5 mm²</option>
                <option value="4">4 mm²</option>
                <option value="6">6 mm²</option>
                <option value="10">10 mm²</option>
              </select>
            </div>
            <div class="col-6">
              <select class="form-select" id="cor">
                <option value="">Cor</option>
                <option>Castanho</option>
                <option>Preto</option>
                <option>Azul</option>
                <option>Amarelo/Verde</option>
                <option>Cinzento</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Peso -->
        <div class="mb-3">
          <label class="form-label">Peso por metro</label>
          <div class="row g-2">
            <div class="col-6">
              <input type="number" step="0.0001" class="form-control" id="pesoPorMetro" placeholder="Peso por metro">
            </div>
            <div class="col-6">
              <input type="text" class="form-control" id="barcode" placeholder="Código de barras">
            </div>
          </div>
        </div>

        <!-- Preço -->
        <div class="mb-3">
          <div class="linha-preco">
            <label class="form-label m-0">Custo por metro</label>
            <span class="rotulo-euro">€</span>
          </div>
          <input type="number" step="0.01" class="form-control mt-2" id="precoMetro" placeholder="Preço opcional">
        </div>

        <!-- Peso compra -->
        <div class="mb-3">
          <label class="form-label">Peso por comprar</label>
          <div class="row g-2">
            <div class="col-6">
              <input type="number" step="0.01" class="form-control" id="pesoPedaco" placeholder="Peso">
            </div>
            <div class="col-6">
              <select class="form-select" id="unidadePeso">
                <option value="kg">Kg</option>
                <option value="g" selected>g</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Botões -->
        <div class="d-grid gap-2">
          <button class="btn btn-novo" onclick="novoRegistro()">Novo</button>
          <button class="btn btn-outline-secondary" onclick="abrirConsulta()">Consultar</button>
        </div>

        <hr>

        <div class="resultado text-center">
          <p id="resultadoMetros"></p>
          <p id="resultadoPreco"></p>
        </div>

      </div>

    </div>
  </div>
</div>

<!-- Modal Consulta (Tabela organizada) -->
<div class="modal fade" id="modalConsulta" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content" style="border-radius:18px;">
      <div class="modal-header">
        <h5 class="modal-title">Consulta de Registos</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body">

        <div class="d-flex gap-2 mb-3 align-items-center">
          <button class="btn btn-outline-danger btn-sm" type="button" onclick="apagarTudo()">Apagar tudo</button>
          <div class="ms-auto text-muted" id="qtdRegistos"></div>
        </div>

        <div class="table-responsive">
          <table class="table table-sm table-bordered align-middle">
            <thead>
              <tr>
                <th>#</th>
                <th>Bitola</th>
                <th>Cor</th>
                <th>Comprimento (m)</th>
                <th>Preço Total (€)</th>
                <th>Barcode</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody id="tbodyRegistos"></tbody>
          </table>
        </div>

        <div class="text-muted mt-2" style="font-size:.85rem;">
          * Os registos ficam guardados neste navegador (sem base de dados).
        </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
// ===== DADOS =====
const cabos = {
  "1.5":{
    "Castanho":{peso:0.019,preco:0.300,barcode:"0607001915100"},
    "Preto":{peso:0.019,preco:0.300,barcode:"0607001811826"},
    "Azul":{peso:0.019,preco:0.300,barcode:"0607001915000"},
    "Amarelo/Verde":{peso:0.019,preco:0.310,barcode:"0607001915200"},
    "Cinzento":{peso:0.019,preco:0.300,barcode:"2122000035878"}
  },
  "2.5":{
    "Castanho":{peso:0.0304,preco:0.480,barcode:"2122000002650"},
    "Preto":{peso:0.0304,preco:0.480,barcode:"0607001920058"},
    "Azul":{peso:0.0304,preco:0.480,barcode:"0607001920051"},
    "Amarelo/Verde":{peso:0.0304,preco:0.480,barcode:"0607001920054"}
  }
};

const STORAGE_KEY="aap_registos_v1";

const bitola=document.getElementById("bitola");
const cor=document.getElementById("cor");
const pesoPorMetro=document.getElementById("pesoPorMetro");
const barcode=document.getElementById("barcode");
const precoMetro=document.getElementById("precoMetro");
const pesoPedaco=document.getElementById("pesoPedaco");
const unidadePeso=document.getElementById("unidadePeso");

function preencherAuto(){
  if(cabos[bitola.value] && cabos[bitola.value][cor.value]){
    let item=cabos[bitola.value][cor.value];
    pesoPorMetro.value=item.peso;
    precoMetro.value=item.preco;
    barcode.value=item.barcode;
  }
  calcular();
}

function calcular(){
  let ppm=parseFloat(pesoPorMetro.value);
  let preco=parseFloat(precoMetro.value);
  let peso=parseFloat(pesoPedaco.value);

  if(!ppm || !peso){
    resultadoMetros.innerHTML="";
    resultadoPreco.innerHTML="";
    return null;
  }

  if(unidadePeso.value==="g") peso/=1000;

  let metros=peso/ppm;
  resultadoMetros.innerHTML="Comprimento: "+metros.toFixed(2)+" m";

  if(preco){
    let total=metros*preco;
    resultadoPreco.innerHTML="Preço total: € "+total.toFixed(2);
    return {metros,total};
  }else{
    resultadoPreco.innerHTML="Preço total: Não inserido";
    return {metros,total:null};
  }
}

function lerRegistos(){
  try{
    return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
  }catch(e){
    return [];
  }
}

function guardarRegistos(lista){
  localStorage.setItem(STORAGE_KEY,JSON.stringify(lista));
}

function novoRegistro(){
  let r=calcular();
  if(!bitola.value || !cor.value || !r) return;

  let lista=lerRegistos();
  lista.unshift({
    bitola:bitola.value,
    cor:cor.value,
    comprimento:r.metros.toFixed(2),
    preco:r.total ? r.total.toFixed(2) : null,
    barcode:barcode.value
  });
  guardarRegistos(lista);
  limparCampos();
}

function limparCampos(){
  bitola.value="";
  cor.value="";
  pesoPorMetro.value="";
  barcode.value="";
  precoMetro.value="";
  pesoPedaco.value="";
  unidadePeso.value="g";
  resultadoMetros.innerHTML="";
  resultadoPreco.innerHTML="";
}

/* ===== CONSULTA ORGANIZADA EM TABELA ===== */
function abrirConsulta(){
  renderTabela();
  const modalEl=document.getElementById("modalConsulta");
  const modal=new bootstrap.Modal(modalEl);
  modal.show();
}

function renderTabela(){
  const tbody=document.getElementById("tbodyRegistos");
  const qtd=document.getElementById("qtdRegistos");
  const lista=lerRegistos();

  qtd.textContent = `${lista.length} registo(s)`;

  if(!lista.length){
    tbody.innerHTML = `
      <tr>
        <td colspan="7" class="text-center text-muted py-4">
          Sem registos ainda. Faça um cálculo e clique em Novo.
        </td>
      </tr>
    `;
    return;
  }

  tbody.innerHTML = lista.map((r,i)=>{
    const preco = (r.preco===null) ? "Não inserido" : r.preco;
    const bc = r.barcode ? r.barcode : "-";
    return `
      <tr>
        <td>${i+1}</td>
        <td>${r.bitola} mm²</td>
        <td>${r.cor}</td>
        <td>${r.comprimento}</td>
        <td>${preco}</td>
        <td style="font-family:monospace;">${bc}</td>
        <td>
          <button class="btn btn-outline-danger btn-sm" onclick="removerItem(${i})">Remover</button>
        </td>
      </tr>
    `;
  }).join("");
}

function removerItem(index){
  const lista=lerRegistos();
  lista.splice(index,1);
  guardarRegistos(lista);
  renderTabela();
}

function apagarTudo(){
  if(!confirm("Tem certeza que quer apagar todos os registos?")) return;
  guardarRegistos([]);
  renderTabela();
}

/* ===== EVENTOS ===== */
bitola.addEventListener("change",preencherAuto);
cor.addEventListener("change",preencherAuto);
pesoPorMetro.addEventListener("input",calcular);
precoMetro.addEventListener("input",calcular);
pesoPedaco.addEventListener("input",calcular);
unidadePeso.addEventListener("change",calcular);
</script>

</body>
</html>
